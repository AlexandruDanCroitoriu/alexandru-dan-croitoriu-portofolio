FROM alpine:latest

# Runtime deps: match toolchain ABI (libstdc++, libgcc)
RUN apk add --no-cache \
	libstdc++ libgcc \
	boost-libs boost-program_options boost-filesystem boost-thread boost-system boost-regex \
	postgresql-libs
	
# Copy built application and libraries from builder
COPY --from=wt-builder-alexandru-dan-croitoriu-portofolio:latest app/build /app/build 
COPY --from=wt-builder-alexandru-dan-croitoriu-portofolio:latest /usr/lib/libwt*.so.* /usr/lib/

# Copy static resources
COPY ./resources /app/resources
COPY ./dbo /app/dbo
COPY ./static/monaco /app/static/monaco
COPY ./static/xml /app/static/xml
COPY ./static/icons /app/static/icons
COPY --from=builder /app/static/theme/tailwindcss/tailwind.minify.css /app/static/theme/tailwindcss/tailwind.minify.css


WORKDIR /app/build/release
CMD ["./alexandru_dan_croitoriu_portofolio", "--docroot", "../../", "-c", "../../wt_config_release.xml", "--http-address", "0.0.0.0", "--http-port", "9020"]
